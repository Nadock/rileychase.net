#!/usr/bin/env python
"""
Generator script that generates ./weaving/emoji.py from a gemoji source JSON
file.
"""

import json
import pathlib
import subprocess
import sys


def main() -> None:
    if len(sys.argv) != 3:
        print(
            "usage: emoji_py_gen.py [gemoji_json_path] [output_path]",
            file=sys.stderr,
        )
        sys.exit(1)

    src = pathlib.Path(sys.argv[1])
    dest = pathlib.Path(sys.argv[2])

    # Example emoji_db element
    # {
    #     "emoji": "ðŸ˜€",
    #     "description": "grinning face",
    #     "category": "Smileys & Emotion",
    #     "aliases": ["grinning"],
    #     "tags": ["smile", "happy"],
    #     "unicode_version": "6.1",
    #     "ios_version": "6.0",
    # },
    emoji_db = json.loads(src.read_text("utf-8"))

    lines = [
        '"""This file is autogenerated, DO NOT EDIT."""',
        "",
        "EMOJI = {",
    ]

    for emoji_record in emoji_db:
        for alias in emoji_record["aliases"]:
            lines.append(f'    "{alias}": "{emoji_record["emoji"]}",')  # noqa: PERF401

    lines.append("}")

    dest.write_text("\n".join(lines), encoding="utf-8")
    subprocess.run(f"ruff format {dest.absolute()}", check=True, shell=True)  # noqa: S602


if __name__ == "__main__":
    main()
