# rileychase.net

<!-- markdownlint-disable -->

<p align="center">
  <em>Simple static site generator and content that powers <a href="https://rileychase.net">rileychase.net</a>.</em>
  <br><br>
  <a href="https://github.com/Nadock/rileychase.net/actions/workflows/deploy_website.yml">
    <img alt="Deploy website" src="https://github.com/Nadock/rileychase.net/actions/workflows/deploy_website.yml/badge.svg">
  </a>
  <a href="https://github.com/Nadock/rileychase.net/blob/main/Pipfile">
    <img alt="Python 3.11" src="https://img.shields.io/github/pipenv/locked/python-version/Nadock/rileychase.net">
  </a>
  <a href="https://github.com/psf/black">
    <img alt="Code style: black" src="https://img.shields.io/badge/code%20style-black-000000.svg">
  </a>

</p>

## Info For People That Aren't Me

`rileychase.net` is generated by a custom static site generator tool. You can find the source code for that tool under `:/site_generator`.

This tool was not designed to solve anyone's problems but my own, so it isn't published anywhere like PyPi. I'd suggest you consider a more established static site generator for your project. If this hasn't scared you away and you want to give it a shot, I'd recommend forking the repo and deleting all the site contents.

The rest of this `README` contains notes and instructions for me to run my local environment, etc. If you're trying to run the `site_generator` yourself it's probably worth a read.

## Development Environment Setup

To work on the site content or the `site_generator` you will need a working install of Python 3.11 and Pipenv.

1. Clone the repo
2. Setup a Pipenv venv with `pipenv install --dev`
3. Make sure you're using the Pipenv venv with `pipenv shell`

Additionally, I'd recommend you install the [`task` CLI](https://taskfile.dev) as the included `:/Taskfile.yaml` file contains many helpful development shortcut commands. (Think a `Makefile` that sucks way less)

## Site Generator Usage

The site generator has three commands; `build`, `live`, and `validate`. Their use and purpose are described below.

### `build`

Builds the entire site once and writes it to the `output` directory. Exits `0` if the build succeeded or non-zero if it failed.

### `live`

Builds the entire site, then runs a simple Python web server at (by default) `http://localhost:8000`. The `site_generator` then watches the source files for changes, and when a change is detected the site will be rebuilt.

### `validate`

Validate the site pages contents for valid content and front matter information. This only checks semantics, it won't stop you from putting something silly, like a spelling mistake etc, in a field.

## CI/CD

### PR Checks

The following tools run on every PR and must succeed before a branch can be merged to `main`.

- `ruff`, `mypy`, and `black --check` are run to validate code quality.
- Unit tests are run with `pytest`.
- The `site_generator validate` command is run to check page front matter.
- Markdown content is validated by `markdownlint` — install Node.js dependencies for this tool.
- AWS CloudFormation is linted with `cfn-lint`.

All of these checks can be run locally with `task ci`.

### Deploys

On every merge to main, if the site contents was modified, the site will be built and uploaded to AWS S3. Then an invalidation is run on the CloudFront Distribution that hosts the site so the new content appears to users.

## Infrastructure

### S3 and CloudFront

The CloudFormation template `:/aws/website_cfn.yml` contains the S3 & CloudFront combo that actually serves the site contents.

To deploy updates to this template run `task aws:website:deploy`. Note: Changes to the CloudFront Distribution can take a long time to complete. This workflow relies on the `.env` values `DOMAIN_NAME`, and `CERTIFICATE_ARN`.

### GitHub Actions

An IAM Role for GitHub Actions to use in CI/CD is maintain in the `:/aws/gha_role_cfn.yml` CloudFormation template. This used OIDC to authenticate with AWS STS.

To deploy updates to this template run `task aws:gh-actions:deploy`. This workflow relies on the `.env` values `BUCKET_NAME` and `DISTRIBUTION_ID`.

### ACM Certificate

The CloudFormation template `:/aws/acm_cert_cfn.yml` contains the ACM Certificate used by CloudFront to serve our site contents at [rileychase.net](https://rileychase.net).

To deploy updates to this template run `task aws:acm:deploy`. This workflow relies on the `.env` values `DOMAIN_NAME` and `HOSTED_ZONE_ID`.

## To Do

Below is a list of all the stuff that I want to add to the site or the generator tool. Just because it's listed here doesn't mean I will do it though — again, this is just for me.

- [ ] Decide on what we actually want for our favicon
- [ ] Blog support (view list)
  - [ ] Tags support (view list, jump to page)
- [x] Support rendering Jinja elements in page contents
- [x] Enable auto-escaping where possible
- [ ] OpenGraph social link preview headers
- [ ] Dead link detection
- [ ] Non production pages
  - Would imply also adding a "production" build mode
- [ ] Conditional recompile
  - ie: only recompile things that have changed
  - Also maybe look at "de-bouncing" the recompile trigger so a bulk edit of files only triggers one rebuild
- [ ] Static file filters or glob matching so we can have thing in those directories that aren't in the final deployment
